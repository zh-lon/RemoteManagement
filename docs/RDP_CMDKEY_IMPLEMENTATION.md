# RDPè‡ªåŠ¨ç™»å½•å®ç° - cmdkey + mstscæ–¹å¼

## ğŸ¯ å®ç°ç›®æ ‡

æ ¹æ®ç”¨æˆ·è¦æ±‚ï¼Œä¿®æ”¹RDPè¿æ¥æ–¹å¼ï¼Œä½¿ç”¨`cmdkey`å‘½ä»¤é¢„å…ˆå­˜å‚¨å‡­æ®ï¼Œç„¶åå¯åŠ¨mstscå®ç°è‡ªåŠ¨ç™»å½•ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ”§ æŠ€æœ¯å®ç°

### è¿æ¥æµç¨‹
```bash
# ç¬¬ä¸€æ­¥ï¼šå­˜å‚¨å‡­æ®
cmdkey /generic:TERMSRV/æœåŠ¡å™¨åœ°å€ /user:ç”¨æˆ·å /pass:å¯†ç 

# ç¬¬äºŒæ­¥ï¼šå¯åŠ¨è¿æ¥
mstsc RDPæ–‡ä»¶è·¯å¾„
```

### å®ç°é€»è¾‘

#### **1. æ™ºèƒ½è¿æ¥ç­–ç•¥**
```typescript
private async connectRDP(connection: RDPConnection): Promise<OperationResult> {
  // ä¼˜å…ˆä½¿ç”¨cmdkey + mstscæ–¹å¼ï¼ˆæœ‰ç”¨æˆ·åå¯†ç æ—¶ï¼‰
  if (connection.username && connection.password) {
    return await this.connectRDPWithCmdkey(connection, clientConfig);
  }

  // å›é€€åˆ°RDPæ–‡ä»¶æ–¹å¼ï¼ˆæ— å¯†ç æ—¶ï¼‰
  if (window.electronAPI?.writeFile) {
    const rdpFilePath = await this.createRDPFile(connection);
    // ä½¿ç”¨RDPæ–‡ä»¶å¯åŠ¨è¿æ¥
  }

  // æœ€åå›é€€åˆ°åŸºæœ¬è¿æ¥æ–¹å¼
  return await this.launchClientWithConfig(clientConfig, connection);
}
```

#### **2. cmdkey + mstscå®ç°**
```typescript
private async connectRDPWithCmdkey(
  connection: RDPConnection,
  clientConfig: ClientConfig
): Promise<OperationResult> {
  try {
    // æ„å»ºæœåŠ¡å™¨åœ°å€
    const serverAddress = connection.port === 3389 
      ? connection.host 
      : `${connection.host}:${connection.port}`;

    // ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨cmdkeyå­˜å‚¨å‡­æ®
    const cmdkeyArgs = [
      "/generic:TERMSRV/" + serverAddress,
      "/user:" + connection.username,
      "/pass:" + connection.password
    ];

    const cmdkeyResult = await window.electronAPI?.launchProgram("cmdkey", cmdkeyArgs);
    if (!cmdkeyResult?.success) {
      return { success: false, error: "å­˜å‚¨å‡­æ®å¤±è´¥" };
    }

    // ç¬¬äºŒæ­¥ï¼šåˆ›å»ºRDPæ–‡ä»¶æˆ–ä½¿ç”¨åŸºæœ¬è¿æ¥
    let mstscArgs: string[] = [];
    if (window.electronAPI?.writeFile) {
      const rdpFilePath = await this.createRDPFile(connection, false);
      mstscArgs = rdpFilePath ? [rdpFilePath] : [`/v:${serverAddress}`];
    } else {
      mstscArgs = [`/v:${serverAddress}`];
    }

    // ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨mstsc
    const mstscResult = await window.electronAPI?.launchProgram(clientConfig.path, mstscArgs);
    
    return mstscResult?.success 
      ? { success: true, message: "RDPè¿æ¥å·²å¯åŠ¨ - è‡ªåŠ¨ç™»å½•" }
      : { success: false, error: "mstscå¯åŠ¨å¤±è´¥" };
  } catch (error) {
    return { success: false, error: "RDPè¿æ¥å¤±è´¥" };
  }
}
```

#### **3. RDPæ–‡ä»¶ä¼˜åŒ–**
```typescript
private async createRDPFile(
  connection: RDPConnection,
  includePassword: boolean = true
): Promise<string | null> {
  // å½“ä½¿ç”¨cmdkeyæ—¶ï¼ŒincludePassword = false
  // å¯†ç é€šè¿‡cmdkeyé¢„å…ˆå­˜å‚¨ï¼Œä¸åœ¨RDPæ–‡ä»¶ä¸­åŒ…å«
  
  if (includePassword) {
    console.log("RDPæ–‡ä»¶æ¨¡å¼ï¼šç”¨æˆ·éœ€è¦æ‰‹åŠ¨è¾“å…¥å¯†ç ");
  } else {
    console.log("cmdkeyæ¨¡å¼ï¼šå¯†ç å·²é€šè¿‡cmdkeyé¢„å…ˆå­˜å‚¨");
  }
  
  // ç”ŸæˆRDPæ–‡ä»¶å†…å®¹...
}
```

## ğŸš€ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### è¿æ¥æ–¹å¼å¯¹æ¯”

#### **æ–°æ–¹å¼ï¼šcmdkey + mstscï¼ˆè‡ªåŠ¨ç™»å½•ï¼‰**
- âœ… **è‡ªåŠ¨ç™»å½•**ï¼šæ— éœ€æ‰‹åŠ¨è¾“å…¥å¯†ç 
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šä¸€é”®è¿æ¥ï¼Œç›´æ¥è¿›å…¥æ¡Œé¢
- âœ… **å®‰å…¨å¯é **ï¼šå‡­æ®å­˜å‚¨åœ¨Windowså‡­æ®ç®¡ç†å™¨
- âœ… **ç¬¦åˆæ ‡å‡†**ï¼šä½¿ç”¨Windowså®˜æ–¹æ¨èçš„æ–¹å¼

#### **å›é€€æ–¹å¼ï¼šRDPæ–‡ä»¶ï¼ˆæ‰‹åŠ¨è¾“å…¥å¯†ç ï¼‰**
- âš ï¸ **æ‰‹åŠ¨è¾“å…¥**ï¼šéœ€è¦åœ¨ç™»å½•ç•Œé¢è¾“å…¥å¯†ç 
- âœ… **é¢„å¡«ç”¨æˆ·å**ï¼šå‡å°‘éƒ¨åˆ†è¾“å…¥å·¥ä½œ
- âœ… **å®Œæ•´é…ç½®**ï¼šæ”¯æŒåˆ†è¾¨ç‡ã€é‡å®šå‘ç­‰è®¾ç½®

#### **åŸºæœ¬æ–¹å¼ï¼šä»…ä¸»æœºç«¯å£**
- âš ï¸ **æœ€åŸºæœ¬**ï¼šä»…ä¼ é€’ä¸»æœºå’Œç«¯å£
- âš ï¸ **æ‰‹åŠ¨è¾“å…¥**ï¼šéœ€è¦è¾“å…¥æ‰€æœ‰å‡­æ®

### æ™ºèƒ½é€‰æ‹©ç­–ç•¥

```
ç”¨æˆ·åˆ›å»ºRDPè¿æ¥
â”œâ”€â”€ æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ ä½¿ç”¨cmdkey + mstscï¼ˆè‡ªåŠ¨ç™»å½•ï¼‰
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­æ£€æŸ¥
â”œâ”€â”€ æ”¯æŒRDPæ–‡ä»¶åˆ›å»ºï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ åˆ›å»ºRDPæ–‡ä»¶ï¼ˆé¢„å¡«ç”¨æˆ·åï¼‰
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­æ£€æŸ¥
â””â”€â”€ ä½¿ç”¨åŸºæœ¬è¿æ¥ï¼ˆä»…ä¸»æœºç«¯å£ï¼‰
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### Windowså‡­æ®ç®¡ç†å™¨
- **å®‰å…¨å­˜å‚¨**ï¼šå‡­æ®å­˜å‚¨åœ¨Windowsç³»ç»Ÿçš„å‡­æ®ç®¡ç†å™¨ä¸­
- **åŠ å¯†ä¿æŠ¤**ï¼šWindowsè‡ªåŠ¨åŠ å¯†å­˜å‚¨çš„å‡­æ®
- **ç”¨æˆ·éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·çš„å‡­æ®ç‹¬ç«‹å­˜å‚¨
- **ç³»ç»Ÿé›†æˆ**ï¼šä¸Windowså®‰å…¨ä½“ç³»é›†æˆ

### å‡­æ®ç®¡ç†
```bash
# å­˜å‚¨å‡­æ®
cmdkey /generic:TERMSRV/192.168.1.100 /user:admin /pass:password123

# æŸ¥çœ‹å­˜å‚¨çš„å‡­æ®
cmdkey /list

# åˆ é™¤å‡­æ®ï¼ˆå¯é€‰ï¼‰
cmdkey /delete:TERMSRV/192.168.1.100
```

### å®‰å…¨ä¼˜åŠ¿
- âœ… **ä¸åœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºå¯†ç **ï¼šå¯†ç é€šè¿‡å‚æ•°ä¼ é€’ï¼Œä¸åœ¨è¿›ç¨‹åˆ—è¡¨ä¸­æ˜¾ç¤º
- âœ… **ä¸åœ¨RDPæ–‡ä»¶ä¸­å­˜å‚¨å¯†ç **ï¼šé¿å…æ˜æ–‡å¯†ç æ–‡ä»¶
- âœ… **ç³»ç»Ÿçº§åŠ å¯†**ï¼šåˆ©ç”¨Windowså‡­æ®ç®¡ç†å™¨çš„åŠ å¯†æœºåˆ¶
- âœ… **å¯æ§æ¸…ç†**ï¼šå¯ä»¥åœ¨è¿æ¥åæ¸…ç†å­˜å‚¨çš„å‡­æ®

## ğŸ“‹ ä½¿ç”¨è¯´æ˜

### ç”¨æˆ·æ“ä½œæµç¨‹
1. **åˆ›å»ºRDPè¿æ¥**
   - è¾“å…¥ä¸»æœºåœ°å€ï¼š`192.168.1.100`
   - è®¾ç½®ç«¯å£ï¼š`3389`ï¼ˆé»˜è®¤ï¼‰
   - è¾“å…¥ç”¨æˆ·åï¼š`administrator`
   - è¾“å…¥å¯†ç ï¼š`password123`

2. **ç‚¹å‡»è¿æ¥**
   - ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œcmdkeyå­˜å‚¨å‡­æ®
   - åˆ›å»ºä¸´æ—¶RDPæ–‡ä»¶
   - å¯åŠ¨mstscè‡ªåŠ¨ç™»å½•

3. **äº«å—è‡ªåŠ¨ç™»å½•**
   - æ— éœ€æ‰‹åŠ¨è¾“å…¥å¯†ç 
   - ç›´æ¥è¿›å…¥è¿œç¨‹æ¡Œé¢

### ç®¡ç†å‘˜é…ç½®
1. **å®¢æˆ·ç«¯é…ç½®**
   - ç¡®ä¿mstsc.exeè·¯å¾„æ­£ç¡®
   - é€šå¸¸ä¸ºï¼š`mstsc.exe`ï¼ˆç³»ç»ŸPATHä¸­ï¼‰

2. **æƒé™è¦æ±‚**
   - éœ€è¦æ‰§è¡Œcmdkeyå‘½ä»¤çš„æƒé™
   - éœ€è¦å¯åŠ¨mstscçš„æƒé™
   - éœ€è¦è®¿é—®å‡­æ®ç®¡ç†å™¨çš„æƒé™

## ğŸ”„ é”™è¯¯å¤„ç†å’Œå›é€€

### é”™è¯¯å¤„ç†æœºåˆ¶
```typescript
// cmdkeyæ‰§è¡Œå¤±è´¥
if (!cmdkeyResult?.success) {
  return {
    success: false,
    error: "å­˜å‚¨å‡­æ®å¤±è´¥",
    message: cmdkeyResult?.error || "cmdkeyå‘½ä»¤æ‰§è¡Œå¤±è´¥"
  };
}

// mstscå¯åŠ¨å¤±è´¥
if (!mstscResult?.success) {
  return {
    success: false,
    error: "mstscå¯åŠ¨å¤±è´¥",
    message: mstscResult?.error
  };
}
```

### å¤šå±‚å›é€€æœºåˆ¶
1. **cmdkey + mstscå¤±è´¥** â†’ å›é€€åˆ°RDPæ–‡ä»¶æ–¹å¼
2. **RDPæ–‡ä»¶åˆ›å»ºå¤±è´¥** â†’ å›é€€åˆ°åŸºæœ¬è¿æ¥æ–¹å¼
3. **åŸºæœ¬è¿æ¥å¤±è´¥** â†’ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### è°ƒè¯•ä¿¡æ¯
```javascript
// æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹
ä½¿ç”¨cmdkeyå­˜å‚¨å‡­æ®: {
  serverAddress: "192.168.1.100",
  username: "administrator",
  hasPassword: true
}
æ‰§è¡Œcmdkeyå‘½ä»¤...
å‡­æ®å­˜å‚¨æˆåŠŸï¼Œå‡†å¤‡å¯åŠ¨mstsc...
ä½¿ç”¨RDPæ–‡ä»¶å¯åŠ¨mstsc: C:\Users\...\temp\temp_rdp_xxx.rdp
å¯åŠ¨mstsc: { args: ["C:\\Users\\...\\temp\\temp_rdp_xxx.rdp"] }
RDPè¿æ¥å·²å¯åŠ¨ (è¿œç¨‹æ¡Œé¢è¿æ¥) - è‡ªåŠ¨ç™»å½•
```

## ğŸŠ ä¼˜åŠ¿æ€»ç»“

### æŠ€æœ¯ä¼˜åŠ¿
- **âœ… è‡ªåŠ¨ç™»å½•**ï¼šæä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒ
- **âœ… å®‰å…¨å¯é **ï¼šä½¿ç”¨Windowså®˜æ–¹å‡­æ®ç®¡ç†æœºåˆ¶
- **âœ… å…¼å®¹æ€§å¥½**ï¼šæ”¯æŒæ‰€æœ‰Windowsç‰ˆæœ¬
- **âœ… å¤šå±‚å›é€€**ï¼šç¡®ä¿è¿æ¥çš„å¯é æ€§

### ç”¨æˆ·ä½“éªŒ
- **âœ… ä¸€é”®è¿æ¥**ï¼šç‚¹å‡»å³å¯è‡ªåŠ¨ç™»å½•
- **âœ… æ— éœ€è®°å¿†**ï¼šå¯†ç è‡ªåŠ¨ç®¡ç†
- **âœ… å¿«é€Ÿä¾¿æ·**ï¼šå‡å°‘æ“ä½œæ­¥éª¤
- **âœ… ä¸“ä¸šä½“éªŒ**ï¼šç±»ä¼¼ä¼ä¸šçº§è¿œç¨‹ç®¡ç†å·¥å…·

### å®‰å…¨æ€§
- **âœ… ç³»ç»Ÿçº§åŠ å¯†**ï¼šåˆ©ç”¨Windowså®‰å…¨æœºåˆ¶
- **âœ… ç”¨æˆ·éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„å‡­æ®ç©ºé—´
- **âœ… å¯æ§ç®¡ç†**ï¼šæ”¯æŒå‡­æ®çš„æŸ¥çœ‹å’Œæ¸…ç†
- **âœ… æ ‡å‡†åˆè§„**ï¼šç¬¦åˆWindowså®‰å…¨æ ‡å‡†

## ğŸ”® æœªæ¥æ‰©å±•

### å¯èƒ½çš„å¢å¼ºåŠŸèƒ½
1. **å‡­æ®æ¸…ç†**ï¼šè¿æ¥åè‡ªåŠ¨æ¸…ç†å­˜å‚¨çš„å‡­æ®
2. **å‡­æ®ç®¡ç†**ï¼šæä¾›å‡­æ®çš„æŸ¥çœ‹å’Œç®¡ç†ç•Œé¢
3. **æ‰¹é‡è¿æ¥**ï¼šæ”¯æŒæ‰¹é‡å­˜å‚¨å’Œè¿æ¥å¤šä¸ªRDP
4. **è¿æ¥å†å²**ï¼šè®°å½•è¿æ¥å†å²å’Œå‡­æ®ä½¿ç”¨æƒ…å†µ

### é…ç½®é€‰é¡¹
1. **è‡ªåŠ¨æ¸…ç†**ï¼šè¿æ¥åæ˜¯å¦è‡ªåŠ¨æ¸…ç†å‡­æ®
2. **å‡­æ®å¤ç”¨**ï¼šæ˜¯å¦å¤ç”¨å·²å­˜å‚¨çš„å‡­æ®
3. **å®‰å…¨ç­–ç•¥**ï¼šå‡­æ®çš„è¿‡æœŸå’Œæ›´æ–°ç­–ç•¥

**ç°åœ¨RDPè¿æ¥æ”¯æŒè‡ªåŠ¨ç™»å½•ï¼Œç”¨æˆ·ä½“éªŒå¤§å¹…æå‡ï¼** ğŸš€
